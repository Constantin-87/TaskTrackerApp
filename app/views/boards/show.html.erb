<h1 class="display-4 text-center mb-4"><%= @board.name %></h1>

<div class="d-flex justify-content-between align-items-center mb-3">
  <% if current_user.admin? || current_user.manager? %>
    <%= link_to 'Add New Task', new_board_tasks_page_path(@board), class: 'btn btn-success' %>
  <% end %>
</div>

<table class="table table-hover table-bordered table-dark">
  <thead class="thead-light">
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Due Date</th>
      <th>Assign User</th>
      <th class="text-center">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @tasks.each do |task| %>
      <tr>
        <td><%= task.title %></td>
        <td><%= task.description %></td>
        <td><%= task.due_date %></td>
        <td><%= task.status.humanize %></td>
        <td><%= task.priority.humanize %></td>

        <!-- Dropdown to assign user -->
        <td>
          <%= form_with(model: task, url: board_tasks_page_path(@board, task), method: :patch, local: true, class: 'd-inline') do |f| %>
            <div class="input-group">
              <%= f.collection_select :user_id, @users, :id, :email, prompt: "Select user", class: 'form-select bg-secondary text-light' %>
              <button class="btn btn-sm btn-outline-light">Assign</button>
            </div>
          <% end %>
        </td>

        <td class="text-center">
          <%= link_to 'Edit', edit_board_tasks_page_path(@board, task), class: 'btn btn-outline-warning me-2' %>
          <%= link_to 'Delete', board_tasks_page_path(@board, task), method: :delete, data: { turbo_confirm: 'Are you sure?' }, class: 'btn btn-outline-danger' %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<!-- Delete Board Button, visible only to admins or managers -->
<% if current_user.admin? || current_user.manager? %>
  <div class="mt-3">
    <% if @board.tasks.any? %>
      <%= link_to 'Delete Board', board_path(@board), method: :delete, data: { turbo_confirm: "This board has tasks. Deleting this board will also delete all associated tasks. Are you sure you want to continue?" }, class: 'btn btn-danger' %>
    <% else %>
      <%= link_to 'Delete Board', board_path(@board), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this board?" }, class: 'btn btn-danger' %>
    <% end %>
  </div>
<% end %>
